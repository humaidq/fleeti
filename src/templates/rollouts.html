{{ template "head" . }}

<div class="page-header">
  <h2>Rollouts</h2>
  <div class="page-header-actions">
    <a href="/" class="btn">Dashboard</a>
  </div>
</div>

<section class="section-card">
  <h3>Create Rollout</h3>
  <details class="add-item-details">
    <summary class="add-item-summary">+ Create Rollout</summary>
    <form method="post" action="/rollouts" class="add-item-form">
      <input type="hidden" name="_csrf" value="{{ .csrf_token }}" />
      <div class="add-item-field">
        <label for="rollout-fleet">Fleet</label>
        <select id="rollout-fleet" name="fleet_id" class="form-item" required>
          <option value="">Select fleet</option>
          {{ range .Fleets }}
          <option value="{{ .ID }}">{{ .Name }}</option>
          {{ end }}
        </select>
      </div>
      <div class="add-item-field">
        <label for="rollout-release">Release</label>
        <select id="rollout-release" name="release_id" class="form-item" required>
          <option value="">Select release</option>
          {{ range .Releases }}
          <option value="{{ .ID }}"{{ if eq .Status "withdrawn" }} disabled{{ end }}>{{ .Version }} ({{ .Channel }}{{ if .FleetName }} - {{ .FleetName }}{{ end }}{{ if eq .Status "withdrawn" }} - taken down{{ end }})</option>
          {{ end }}
        </select>
      </div>
      <div class="add-item-field">
        <p class="muted-text">Rollout mode is currently fixed to all-at-once (100%).</p>
      </div>
      <button type="submit" class="btn">Create Rollout</button>
    </form>
  </details>
</section>

<section class="section-card">
  <h3>Rollout Plan</h3>
  {{ if .Rollouts }}
  <div class="list-card-list">
    {{ range .Rollouts }}
    <div class="list-card rollout-list-card">
      <a href="/rollouts/{{ .ID }}" class="list-card-link list-card-entry-link">
        <div class="list-card-entry">
          <span class="list-card-leading">
            <span class="list-card-icon" aria-hidden="true"><i class="fa-solid fa-rocket"></i></span>
          </span>
          <div class="list-card-entry-body">
            <div class="list-card-title">{{ .ReleaseVersion }} for {{ .FleetName }}</div>
            <div class="list-card-meta rollout-list-meta">
              <span class="muted-text">Rollout: <code>{{ .ID }}</code></span>
              <span class="muted-text">Release status: <span class="status-badge status-{{ .ReleaseStatus }}">{{ if eq .ReleaseStatus "withdrawn" }}taken down{{ else }}{{ .ReleaseStatus }}{{ end }}</span></span>
              <span class="muted-text">Strategy: {{ .Strategy }}</span>
              <span class="muted-text">Stage: {{ .StagePercent }}%</span>
              <span class="muted-text">Status: <span class="status-badge status-{{ .Status }}">{{ .Status }}</span></span>
              <span class="muted-text">Started (UTC): {{ if .StartedAt }}{{ .StartedAt }}{{ else }}-{{ end }}</span>
            </div>
          </div>
        </div>
      </a>
    </div>
    {{ end }}
  </div>
  {{ else }}
  <p class="muted-text">No rollouts yet.</p>
  {{ end }}
</section>

{{ template "foot" . }}
