{{ template "head" . }}

<div class="page-header">
  <h2>Devices</h2>
  <div class="page-header-actions">
    <a href="/" class="btn">Dashboard</a>
  </div>
</div>

<section class="section-card">
  <h3>Create Device</h3>
  <details class="add-item-details">
    <summary class="add-item-summary">+ Create Device</summary>
    <form method="post" action="/devices" class="add-item-form">
      <input type="hidden" name="_csrf" value="{{ .csrf_token }}" />
      <div class="add-item-field">
        <label for="device-fleet">Fleet</label>
        <select id="device-fleet" name="fleet_id" class="form-item" required>
          <option value="">Select fleet</option>
          {{ range .Fleets }}
          <option value="{{ .ID }}">{{ .Name }}</option>
          {{ end }}
        </select>
      </div>
      <div class="add-item-field">
        <label for="device-hostname">Hostname</label>
        <input id="device-hostname" name="hostname" class="form-item" required />
      </div>
      <div class="add-item-field">
        <label for="device-serial">Serial Number</label>
        <input id="device-serial" name="serial_number" class="form-item" required />
      </div>
      <div class="add-item-field">
        <label for="device-state">Update State</label>
        <select id="device-state" name="update_state" class="form-item">
          <option value="idle">idle</option>
          <option value="downloading">downloading</option>
          <option value="applying">applying</option>
          <option value="rebooting">rebooting</option>
          <option value="healthy">healthy</option>
          <option value="degraded">degraded</option>
          <option value="failed">failed</option>
        </select>
      </div>
      <div class="add-item-field">
        <label for="device-attestation">Attestation Level</label>
        <input id="device-attestation" name="attestation_level" class="form-item" value="unknown" />
      </div>
      <button type="submit" class="btn">Create Device</button>
    </form>
  </details>
</section>

<section class="section-card">
  <h3>Device Inventory</h3>
  {{ if .Devices }}
  <div class="table-card">
    <table class="contacts-list">
      <thead>
        <tr>
          <th>Hostname</th>
          <th>Serial</th>
          <th>Fleet</th>
          <th>State</th>
          <th>Current</th>
          <th>Desired</th>
          <th>Last Seen (UTC)</th>
        </tr>
      </thead>
      <tbody>
      {{ range .Devices }}
        <tr>
          <td><strong>{{ .Hostname }}</strong></td>
          <td><code>{{ .SerialNumber }}</code></td>
          <td>{{ .FleetName }}</td>
          <td>
            <span class="status-badge status-{{ .UpdateState }}">{{ .UpdateState }}</span>
            <span class="muted-text">{{ .AttestationLevel }}</span>
          </td>
          <td>{{ if .CurrentReleaseVersion }}{{ .CurrentReleaseVersion }}{{ else }}<span class="muted-text">-</span>{{ end }}</td>
          <td>{{ if .DesiredReleaseVersion }}{{ .DesiredReleaseVersion }}{{ else }}<span class="muted-text">-</span>{{ end }}</td>
          <td>{{ if .LastSeenAt }}{{ .LastSeenAt }}{{ else }}<span class="muted-text">-</span>{{ end }}</td>
        </tr>
      {{ end }}
      </tbody>
    </table>
  </div>
  {{ else }}
  <p class="muted-text">No devices yet.</p>
  {{ end }}
</section>

{{ template "foot" . }}
